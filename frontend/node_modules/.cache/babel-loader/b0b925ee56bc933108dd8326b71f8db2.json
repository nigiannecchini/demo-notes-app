{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ngiannecchin/MercadoLivre/Projetos/Nilo/serveless/notes/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/ngiannecchin/MercadoLivre/Projetos/Nilo/serveless/notes/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/ngiannecchin/MercadoLivre/Projetos/Nilo/serveless/notes/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useRef,useState,useEffect}from\"react\";import Form from\"react-bootstrap/Form\";import{API,Storage}from\"aws-amplify\";import{useParams,useHistory}from\"react-router-dom\";import LoaderButton from\"../components/LoaderButton\";import{onError}from\"../libs/errorLib\";import{s3Upload}from\"../libs/awsLib\";import config from\"../config\";import\"./Notes.css\";export default function Notes(){var file=useRef(null);var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),note=_useState2[0],setNote=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),content=_useState4[0],setContent=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isDeleting=_useState8[0],setIsDeleting=_useState8[1];useEffect(function(){function loadNote(){return API.get(\"notes\",\"/notes/\".concat(id));}function onLoad(){return _onLoad.apply(this,arguments);}function _onLoad(){_onLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _note,_content,attachment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return loadNote();case 3:_note=_context.sent;_content=_note.content,attachment=_note.attachment;if(!attachment){_context.next=9;break;}_context.next=8;return Storage.vault.get(attachment);case 8:_note.attachmentURL=_context.sent;case 9:setContent(_content);setNote(_note);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);onError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _onLoad.apply(this,arguments);}onLoad();},[id]);function validateForm(){return content.length>0;}function formatFilename(str){return str.replace(/^\\w+-/,\"\");}function handleFileChange(event){file.current=event.target.files[0];}function saveNote(note){return API.put(\"notes\",\"/notes/\".concat(id),{body:note});}function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var attachment;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();if(!(file.current&&file.current.size>config.MAX_ATTACHMENT_SIZE)){_context2.next=4;break;}alert(\"Please pick a file smaller than \".concat(config.MAX_ATTACHMENT_SIZE/1000000,\" MB.\"));return _context2.abrupt(\"return\");case 4:setIsLoading(true);_context2.prev=5;if(!file.current){_context2.next=10;break;}_context2.next=9;return s3Upload(file.current);case 9:attachment=_context2.sent;case 10:_context2.next=12;return saveNote({content:content,attachment:attachment||note.attachment});case 12:history.push(\"/\");_context2.next=19;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](5);onError(_context2.t0);setIsLoading(false);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[5,15]]);}));return _handleSubmit.apply(this,arguments);}function deleteNote(){return API.del(\"notes\",\"/notes/\".concat(id));}function handleDelete(_x2){return _handleDelete.apply(this,arguments);}function _handleDelete(){_handleDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var confirmed;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:event.preventDefault();confirmed=window.confirm(\"Are you sure you want to delete this note?\");if(confirmed){_context3.next=4;break;}return _context3.abrupt(\"return\");case 4:setIsDeleting(true);_context3.prev=5;_context3.next=8;return deleteNote();case 8:history.push(\"/\");_context3.next=15;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](5);onError(_context3.t0);setIsDeleting(false);case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[5,11]]);}));return _handleDelete.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"Notes\",children:note&&/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Group,{controlId:\"content\",children:/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",value:content,onChange:function onChange(e){return setContent(e.target.value);}})}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"file\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Attachment\"}),note.attachment&&/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:note.attachmentURL,children:formatFilename(note.attachment)})}),/*#__PURE__*/_jsx(Form.Control,{onChange:handleFileChange,type:\"file\"})]}),/*#__PURE__*/_jsx(LoaderButton,{block:true,size:\"lg\",type:\"submit\",isLoading:isLoading,disabled:!validateForm(),children:\"Save\"}),/*#__PURE__*/_jsx(LoaderButton,{block:true,size:\"lg\",variant:\"danger\",onClick:handleDelete,isLoading:isDeleting,children:\"Delete\"})]})});}","map":{"version":3,"sources":["/Users/ngiannecchin/MercadoLivre/Projetos/Nilo/serveless/notes/frontend/src/containers/Notes.js"],"names":["React","useRef","useState","useEffect","Form","API","Storage","useParams","useHistory","LoaderButton","onError","s3Upload","config","Notes","file","id","history","note","setNote","content","setContent","isLoading","setIsLoading","isDeleting","setIsDeleting","loadNote","get","onLoad","attachment","vault","attachmentURL","validateForm","length","formatFilename","str","replace","handleFileChange","event","current","target","files","saveNote","put","body","handleSubmit","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","push","deleteNote","del","handleDelete","confirmed","window","confirm","e","value"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport Form from \"react-bootstrap/Form\";\nimport { API, Storage } from \"aws-amplify\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { onError } from \"../libs/errorLib\";\nimport { s3Upload } from \"../libs/awsLib\";\nimport config from \"../config\";\nimport \"./Notes.css\";\n\nexport default function Notes() {\n  const file = useRef(null);\n  const { id } = useParams();\n  const history = useHistory();\n  const [note, setNote] = useState(null);\n  const [content, setContent] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  useEffect(() => {\n    function loadNote() {\n      return API.get(\"notes\", `/notes/${id}`);\n    }\n\n    async function onLoad() {\n      try {\n        const note = await loadNote();\n        const { content, attachment } = note;\n\n        if (attachment) {\n          note.attachmentURL = await Storage.vault.get(attachment);\n        }\n\n        setContent(content);\n        setNote(note);\n      } catch (e) {\n        onError(e);\n      }\n    }\n\n    onLoad();\n  }, [id]);\n\n  function validateForm() {\n    return content.length > 0;\n  }\n\n  function formatFilename(str) {\n    return str.replace(/^\\w+-/, \"\");\n  }\n\n  function handleFileChange(event) {\n    file.current = event.target.files[0];\n  }\n\n  function saveNote(note) {\n    return API.put(\"notes\", `/notes/${id}`, {\n      body: note\n    });\n  }\n\n  async function handleSubmit(event) {\n    let attachment;\n\n    event.preventDefault();\n\n    if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n      alert(\n        `Please pick a file smaller than ${\n          config.MAX_ATTACHMENT_SIZE / 1000000\n        } MB.`\n      );\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      if (file.current) {\n        attachment = await s3Upload(file.current);\n      }\n\n      await saveNote({\n        content,\n        attachment: attachment || note.attachment\n      });\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsLoading(false);\n    }\n  }\n\n  function deleteNote() {\n    return API.del(\"notes\", `/notes/${id}`);\n  }\n\n  async function handleDelete(event) {\n    event.preventDefault();\n\n    const confirmed = window.confirm(\n      \"Are you sure you want to delete this note?\"\n    );\n\n    if (!confirmed) {\n      return;\n    }\n\n    setIsDeleting(true);\n\n    try {\n      await deleteNote();\n      history.push(\"/\");\n    } catch (e) {\n      onError(e);\n      setIsDeleting(false);\n    }\n  }\n\n  return (\n    <div className=\"Notes\">\n      {note && (\n        <Form onSubmit={handleSubmit}>\n          <Form.Group controlId=\"content\">\n            <Form.Control\n              as=\"textarea\"\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n            />\n          </Form.Group>\n          <Form.Group controlId=\"file\">\n            <Form.Label>Attachment</Form.Label>\n            {note.attachment && (\n              <p>\n                <a\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  href={note.attachmentURL}\n                >\n                  {formatFilename(note.attachment)}\n                </a>\n              </p>\n            )}\n            <Form.Control onChange={handleFileChange} type=\"file\" />\n          </Form.Group>\n          <LoaderButton\n            block\n            size=\"lg\"\n            type=\"submit\"\n            isLoading={isLoading}\n            disabled={!validateForm()}\n          >\n            Save\n          </LoaderButton>\n          <LoaderButton\n            block\n            size=\"lg\"\n            variant=\"danger\"\n            onClick={handleDelete}\n            isLoading={isDeleting}\n          >\n            Delete\n          </LoaderButton>\n        </Form>\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}